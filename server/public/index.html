<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>La Dimensionneuse</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="master.min.css">
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
</head>

<body>

    <header>
        <div id="title">La Dimensionneuse</div>
        <div id="icons">
            <a href="https://restore.woma.fr/"><i class="material-icons">home</i></a>
            <a href=""><i class="material-icons">info</i></a>
            <a href="https://github.com/Re-Store/Dimensionneuse"><i class="material-icons">code</i></a>
        </div>
    </header>

    <div id="container">
        <div class="card">

            <div><button id="calib" onclick="calibrate()"><i class="material-icons">settings</i> CALIBRATE</button>
            </div>

            <div class="separator"></div>

            <div>Re-Store</div>
            <div>Material: <select name="materiau" id="materiau">
                    <option selected="true" disabled>---</option>
                </select></div>
            <div>Volume: <select name="volume" id="volume">
                    <option selected="true" disabled>---</option>
                </select></div>

            <div class="separator"></div>

            <div>X: <input type="number" class="inputMesure" name="x" id="x"> ± <input type="number"
                    class="inputPrecision" name="px" id="px" value="10"></div>
            <div>Y: <input type="number" class="inputMesure" name="y" id="y"> ± <input type="number"
                    class="inputPrecision" name="py" id="py" value="10"></div>
            <div>Z: <input type="number" class="inputMesure" name="z" id="z"> ± <input type="number"
                    class="inputPrecision" name="pz" id="pz" value="1"></div>
            <div> (measure X <input type="checkbox" name="cx" id="cx" checked>, Y <input type="checkbox" name="cy"
                    id="cy" checked>, Z
                <input type="checkbox" name="cz" id="cz" checked>)</div>
            <div><button id="mesure" onclick="mesure()"><i class="material-icons">search</i> MEASURE</button></div>

            <div class="separator"></div>

            <div><button id="upload" onclick="upload()"><i class="material-icons">publish</i> UPLOAD</button></div>
        </div>

        <textarea name="console" id="console" cols="35" rows="20" readonly>
        </textarea>

    </div>

</body>

<script>

    function outputToConsole(text) {
        $("#console").val(text + "\n\n" + $("#console").val());
    }

    function populateSelectWithJSON(id, url) {
        let select = $("#" + id);
        $.getJSON(url, function (data) {
            $.each(data, function (key, entry) {
                select.append($('<option></option>').attr('value', entry.code).text(entry.name));
            })
        });
    }

    populateSelectWithJSON("materiau", "config/materials.json");
    populateSelectWithJSON("volume", "config/volumes.json");

    function calibrate() {
        $.post(
            "calibrate",
            {},
            function (data) {
                outputToConsole(data);
            }
        );
    }

    function mesure() {
        $.get(
            "measure",
            { x: $("#cx").val(), y: $("#cy").val(), z: $("#cz").val() },
            function (data) {
                outputToConsole(data);
            }
        );
    }

    function upload() {
        $.post(
            "upload",
            {
                x: $("#x").val(), y: $("#y").val(), z: $("#z").val(),
                px: $("#px").val(), py: $("#py").val(), pz: $("#pz").val(),
                mat: $("#materiau").val(), vol: $("#volume").val()
            },
            function (data) {
                outputToConsole(data);
            }
        );
    }
</script>

</html>