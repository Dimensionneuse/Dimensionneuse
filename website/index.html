<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>La Dimensionneuse</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="master.min.css">
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
</head>

<body>

    <header>
        <div id="title">La Dimensionneuse</div>
        <div id="icons">
            <a href="https://restore.woma.fr/"><i class="material-icons">home</i></a>
            <a href=""><i class="material-icons">info</i></a>
            <a href="https://github.com/Re-Store/Dimensionneuse"><i class="material-icons">code</i></a>
        </div>
    </header>

    <div id="container">

        <!-- Control card -->
        <div class="card">

            <!-- Calibrate button -->
            <div>
                <button id="calib" onclick="calibrate()"><i class="material-icons">settings</i> CALIBRATE</button>
            </div>

            <div class="separator"></div>

            <!-- Location, material & volume selection -->
            <div>Location: <select name="location" id="location">
                    <option selected="true" disabled>---</option>
                </select></div>
            <div>Material: <select name="material" id="material">
                    <option selected="true" disabled>---</option>
                </select></div>
            <div>Volume: <select name="volume" id="volume">
                    <option selected="true" disabled>---</option>
                </select></div>

            <div class="separator"></div>

            <!-- Measure and precision input -->
            <div>X: <input type="number" class="inputMeasure" name="x" id="x">
                ± <input type="number" class="inputPrecision" name="px" id="px" value="10"> mm</div>
            <div>Y: <input type="number" class="inputMeasure" name="y" id="y">
                ± <input type="number" class="inputPrecision" name="py" id="py" value="10"> mm</div>
            <div>Z: <input type="number" class="inputMeasure" name="z" id="z">
                ± <input type="number" class="inputPrecision" name="pz" id="pz" value="1"> mm</div>
            <div> (measure
                X <input type="checkbox" name="cx" id="cx" checked>,
                Y <input type="checkbox" name="cy" id="cy" checked>,
                Z <input type="checkbox" name="cz" id="cz" checked>)</div>
            <div><button id="measure" onclick="measure()"><i class="material-icons">search</i> MEASURE</button></div>

            <div class="separator"></div>

            <!-- Upload button -->
            <div><button id="upload" onclick="upload()"><i class="material-icons">publish</i> UPLOAD</button></div>
        </div>

        <!-- Console card -->
        <textarea name="console" id="console" cols="35" rows="20" readonly>
        </textarea>

    </div>

</body>

<script>

    function outputToConsole(text) {
        $("#console").val(text + "\n\n" + $("#console").val());
    }

    function populateSelectWithJSON(id, url) {
        let select = $("#" + id);
        $.getJSON(url, function (data) {
            $.each(data, function (key, entry) {
                select.append($('<option></option>').attr('value', entry.code).text(entry.name));
            })
        });
    }

    populateSelectWithJSON("location", "config/locations.json");
    populateSelectWithJSON("material", "config/materials.json");
    populateSelectWithJSON("volume", "config/volumes.json");

    function calibrate() {
        $.post(
            "calibrate",
            {},
            function (data) {
                outputToConsole(data);
            }
        );
    }

    function measure() {
        $.get(
            "measure",
            { x: $("#cx").val(), y: $("#cy").val(), z: $("#cz").val() },
            function (data) {
                let log = "Measured"
                if (data.x !== false) {
                    $("#x").val(data.x)
                    log += " x=" + data.x
                }
                if (data.y !== false) {
                    $("#y").val(data.y)
                    log += " y=" + data.y
                }
                if (data.z !== false) {
                    $("#z").val(data.z)
                    log += " z=" + data.z
                }
                outputToConsole(log + ".");
            }
        );
    }

    function upload() {
        $.post(
            "upload",
            {
                measure: [$("#x").val(), $("#y").val(), $("#z").val()],
                precision: [$("#px").val(), $("#py").val(), $("#pz").val()],
                mat: $("#material").val(), vol: $("#volume").val(), loc: $("#location").val()
            },
            function (data) {
                outputToConsole(data);
            }
        );
    }
</script>

</html>