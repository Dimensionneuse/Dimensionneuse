<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>La Dimensionneuse</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="master.min.css">
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
</head>

<body>

    <header>
        <div id="title">La Dimensionneuse</div>
        <div id="icons">
            <a href="https://restore.woma.fr/"><i class="material-icons">home</i></a>
            <a href="https://github.com/Re-Store/Dimensionneuse"><i class="material-icons">code</i></a>
            <a href="/index.html"><i class="material-icons">search</i></a>
        </div>
    </header>

    <div class="card">
        <div><button id="refresh" onclick="fetch()"><i class="material-icons">refresh</i> FETCH</button></div>

        <table id="results">
            <tbody>
                <tr>
                    <th>ID</th>
                    <th>x</th>
                    <th></th>
                    <th>y</th>
                    <th></th>
                    <th>z</th>
                    <th></th>
                    <th>Material</th>
                    <th>Volume</th>
                    <th>Location</th>
                    <th></th>
                    <th></th>
                </tr>
            </tbody>
        </table>
    </div>
</body>

<script>
    function fetch() {
        $.get(
            "fetch",
            {},
            function (data) {
                console.log(data);
                $(".result").remove()
                if (typeof data == "string") {
                    // Display error
                } else {
                    let nb = 0
                    data.rows.forEach(elem => {
                        let id = `<td>${elem.id}</td>`
                        let x = `<td class="measuretd"><input type="number" id="x${nb}" class="measure" value="${elem.x}"></td>`
                        let px = `<td>± <input type="number" id="px${nb}" class="precision" value="${elem.px}"></td>`
                        let y = `<td class="measuretd"><input type="number" id="y${nb}" class="measure" value="${elem.y}"></td>`
                        let py = `<td>± <input type="number" id="py${nb}" class="precision" value="${elem.py}"></td>`
                        let z = `<td class="measuretd"><input type="number" id="z${nb}" class="measure" value="${elem.z}"></td>`
                        let pz = `<td>± <input type="number" id="pz${nb}" class="precision" value="${elem.pz}"></td>`
                        let mat = `<td>${elem.material}</td>`
                        let vol = `<td>${elem.volume}</td>`
                        let loc = `<td>${elem.location}</td>`
                        let pub = `<td class="icontd"><i class="material-icons" onclick="publish(${nb})">publish</i></td>`
                        let del = `<td class="icontd"><i class="material-icons" onclick="delete(${nb})">delete</i></td>`
                        let content = id + x + px + y + py + z + pz + mat + vol + loc + pub + del
                        $('#results > tbody:last-child').append(`<tr class="result" id="result${nb}">${content}</tr>`)
                    })
                }
            }
        )
    }
</script>

</html>